<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Road-Trip Rally üöó</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<style>
  :root{
    --bg:#0b0f14; --bg2:#111827; --ink:#e6eefc; --ink-d:#a8b3cd;
    --accent:#7dd3fc; --accent2:#f6a93b; --good:#3ecf8e; --warn:#f59e0b; --bad:#ef476f;
    --glass: rgba(255,255,255,0.07);
  }
  html,body{height:100%;margin:0;background:radial-gradient(1200px 700px at 70% -10%, #1b2235 0%, #0f1422 45%, var(--bg) 100%);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:clamp(12px,3vmin,32px);}
  h1{font-size:clamp(24px,3.2vmax,40px);margin:16px 0 8px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));border:1px solid rgba(255,255,255,0.08);box-shadow:0 10px 40px rgba(0,0,0,0.35);border-radius:20px;padding:18px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.15);border-radius:12px;padding:10px 14px;color:var(--ink);cursor:pointer;user-select:none}
  .btn.primary{background:linear-gradient(180deg,var(--accent),#4fb9ec);color:#071521;border:none;font-weight:700}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  input, .code{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:var(--ink)}
  input::placeholder{color:var(--ink-d)}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;background:rgba(255,255,255,0.08);border-radius:999px;border:1px solid rgba(255,255,255,0.12)}
  .muted{color:var(--ink-d)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
  canvas{width:100%;height:70vh;background:linear-gradient(#0a0e17,#0b1726 30%, #0c1a2b);}
  .hud{position:fixed;inset:auto 0 16px 0;display:flex;justify-content:center;pointer-events:none}
  .hud .bar{display:flex;gap:8px;padding:10px 14px;background:rgba(0,0,0,0.35);backdrop-filter:blur(6px);border-radius:14px;border:1px solid rgba(255,255,255,0.15)}
  .stat{min-width:80px;text-align:center}
  .fuel{width:160px;height:10px;background:rgba(255,255,255,0.12);border-radius:999px;overflow:hidden}
  .fuel > div{height:100%;background:linear-gradient(90deg,#4ade80,#facc15,#ef4444);width:50%}
  .corner{position:fixed;top:12px;right:12px;display:flex;gap:8px}
  .minipad{position:fixed;left:12px;bottom:12px;display:none;gap:10px;flex-direction:column}
  .padrow{display:flex;gap:10px;justify-content:center}
  .padbtn{width:64px;height:64px;border-radius:50%;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;font-weight:800;user-select:none}
  @media (max-width: 820px){ .minipad{display:flex} canvas{height:64vh} }
  .lobbylist{display:flex;flex-wrap:wrap;gap:8px}
  .tag{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Road-Trip Rally <span class="muted">‚Ä¢ Multiplayer Prototype</span></h1>

  <div id="screen-home" class="card">
    <div class="row" style="align-items:flex-end">
      <div style="flex:1;min-width:260px">
        <label>Name</label>
        <input id="name" placeholder="Your display name" />
      </div>
      <div>
        <label>Color</label>
        <input id="color" type="color" value="#7dd3fc" />
      </div>
    </div>
    <div style="height:12px"></div>
    <div class="row">
      <div class="card" style="flex:1">
        <h3>Create Room</h3>
        <button id="btnCreate" class="btn primary">Create</button>
      </div>
      <div class="card" style="flex:2">
        <h3>Join Room</h3>
        <div class="row">
          <input id="joinCode" placeholder="Enter code (e.g., 7Q2K8M)" />
          <button id="btnJoin" class="btn">Join</button>
        </div>
      </div>
    </div>
    <div style="height:8px"></div>
    <div class="muted">Controls: <b>W / ‚Üë</b> throttle, <b>S / ‚Üì</b> brake, <b>A/D / ‚Üê/‚Üí</b> steer, <b>F</b> refuel at gas.</div>
  </div>

  <div id="screen-lobby" class="card" style="display:none">
    <div class="row" style="align-items:center;justify-content:space-between">
      <div>Room Code: <span id="roomCode" class="code" style="font-weight:800;letter-spacing:2px;padding:8px 10px"></span></div>
      <div class="row">
        <button id="btnReady" class="btn">Ready</button>
        <button id="btnStart" class="btn primary" title="Host can start">Start</button>
      </div>
    </div>
    <div style="height:12px"></div>
    <div class="lobbylist" id="lobbyList"></div>
  </div>

  <div id="screen-game" class="card" style="display:none">
    <canvas id="game" width="1100" height="640"></canvas>
    <div class="hud">
      <div class="bar">
        <div class="stat">Speed<br><b id="uiSpeed">0</b> m/s</div>
        <div class="stat">Distance<br><b id="uiDist">0</b> m</div>
        <div class="stat">Fuel<br>
          <div class="fuel"><div id="fuelFill"></div></div>
        </div>
        <div class="stat">Room<br><b id="uiRoom">‚Äî</b></div>
      </div>
    </div>
    <div class="corner">
      <span class="pill">Ping: <b id="uiPing">‚Äî</b> ms</span>
      <span class="pill">Players: <b id="uiPCount">‚Äî</b></span>
    </div>
  </div>
</div>

<!-- Mobile mini pad -->
<div class="minipad" id="pad">
  <div class="padrow">
    <div class="padbtn" data-steer="-1">‚óÄ</div>
    <div class="padbtn" data-throttle="1">‚ñ≤</div>
    <div class="padbtn" data-steer="1">‚ñ∂</div>
  </div>
  <div class="padrow">
    <div class="padbtn" data-brake="1">‚ñº</div>
    <div class="padbtn" data-refuel="1">‚õΩ</div>
  </div>
</div>

<!-- Firebase (compat) for Analytics ONLY; safe to expose this config -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics-compat.js"></script>
<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAbB3TV8nkRMafGhWIYzT5jmKVrCP9-wh4",
    authDomain: "quizle-90a38.firebaseapp.com",
    databaseURL: "https://quizle-90a38-default-rtdb.firebaseio.com",
    projectId: "quizle-90a38",
    storageBucket: "quizle-90a38.firebasestorage.app",
    messagingSenderId: "904768412560",
    appId: "1:904768412560:web:a34e55d0d1e4c594e9f115",
    measurementId: "G-PWRB2K17JR"
  };
  firebase.initializeApp(firebaseConfig);
  let analytics;
  try { analytics = firebase.analytics(); } catch (e) { console.warn("Analytics init failed:", e); }
  function logEvt(name, params){ try { analytics && analytics.logEvent(name, params||{}); } catch(e){} }
</script>

<!-- Socket.IO client from CDN (so Pages can call a remote server) -->
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>

<script>
/* ===========================
   Client for Road-Trip Rally
   =========================== */

const $ = (q)=>document.querySelector(q);

// If hosting the client on Cloudflare Pages and the server elsewhere,
// set window.SOCKET_URL = "https://your-socket-server.example.com" via <script> BEFORE this file.
// Fallback to same-origin for local dev.
const SOCKET_URL = window.SOCKET_URL || window.location.origin;
const socket = io(SOCKET_URL, { transports: ["websocket"] });

// ---- UI / State ----
const S = {
  me: null, isHost: false,
  code: null, seed: 0, phase: "lobby",
  players: new Map(),
  input: { throttle:0, brake:0, steer:0, refuel:false },
  lastStateAt: 0, ping: "‚Äî",
  interp: new Map(),
};
const $home = $("#screen-home"), $lobby = $("#screen-lobby"), $game = $("#screen-game");
const $roomCode = $("#roomCode"), $lobbyList = $("#lobbyList");
const $uiSpeed = $("#uiSpeed"), $uiDist = $("#uiDist"), $uiRoom = $("#uiRoom"), $uiPing = $("#uiPing"), $uiPCount = $("#uiPCount");
const $fuelFill = $("#fuelFill");

function show(id) {
  $home.style.display = id==="home"?"block":"none";
  $lobby.style.display = id==="lobby"?"block":"none";
  $game.style.display = id==="game"?"block":"none";
}

$("#btnCreate").onclick = () => {
  socket.emit("createRoom", { name: $("#name").value, color: $("#color").value });
  logEvt("create_room_click");
};
$("#btnJoin").onclick = () => {
  socket.emit("joinRoom", { code: $("#joinCode").value, name: $("#name").value, color: $("#color").value });
  logEvt("join_room_click", { code: ($("#joinCode").value||"").trim().toUpperCase() });
};
$("#btnReady").onclick = () => {
  S.meReady = !S.meReady;
  socket.emit("setReady", S.meReady);
  $("#btnReady").textContent = S.meReady ? "Ready ‚úì" : "Ready";
  logEvt("toggle_ready", { ready: S.meReady });
};
$("#btnStart").onclick = () => { socket.emit("startGame"); logEvt("start_click"); };

// Mini pad (mobile)
for (const el of document.querySelectorAll(".padbtn")) {
  let down = false;
  el.addEventListener("pointerdown", (e)=>{ e.preventDefault(); down=true; setFromPad(el, true); });
  el.addEventListener("pointerup", ()=>{ down=false; setFromPad(el, false); });
  el.addEventListener("pointerleave", ()=>{ if(down){down=false; setFromPad(el,false);} });
}
function setFromPad(el, active){
  if (el.dataset.throttle) S.input.throttle = active ? 1 : 0;
  if (el.dataset.brake)    S.input.brake = active ? 1 : 0;
  if (el.dataset.steer)    S.input.steer = active ? Number(el.dataset.steer) : 0;
  if (el.dataset.refuel)   S.input.refuel = !!active;
}

// ---- Net events ----
socket.on("errorMsg", (m)=>alert(m));
socket.on("joined", (data)=>{
  S.code = data.code; S.seed = data.seed; S.phase = data.phase;
  $roomCode.textContent = data.code;
  S.me = data.playerId;
  S.isHost = (data.players.find(p=>p.id===S.me)?.isHost) || false;
  $("#btnStart").style.display = S.isHost ? "inline-flex" : "none";
  updateLobbyList(data.players);
  $("#uiRoom").textContent = S.code;
  show("lobby");
  logEvt("joined_room", { code: data.code });
});
socket.on("lobby", (data)=>{
  S.seed = data.seed; S.phase = data.phase;
  S.isHost = (data.players.find(p=>p.id===S.me)?.isHost) || false;
  $("#btnStart").style.display = S.isHost ? "inline-flex" : "none";
  updateLobbyList(data.players);
});
socket.on("start", ({seed})=>{
  S.phase = "running"; S.seed = seed;
  show("game");
  logEvt("game_started", { code: S.code });
});
socket.on("state", (payload)=>{
  S.phase = payload.phase; S.lastStateAt = performance.now();
  const ids = new Set();
  payload.players.forEach(p=>{
    ids.add(p.id);
    const prev = S.players.get(p.id);
    S.players.set(p.id, p);
    if (p.id !== S.me) {
      const from = prev || p;
      S.interp.set(p.id, { from, to: p, t0: performance.now(), t1: performance.now()+1000/20 });
    }
  });
  for (const id of Array.from(S.players.keys())) if (!ids.has(id)) { S.players.delete(id); S.interp.delete(id); }
  $uiPCount.textContent = S.players.size;
});

// Ping (custom; server echoes back)
setInterval(()=>{
  const t = performance.now();
  socket.emit("pingCheck", { t });
}, 2000);
socket.on("pong", (d)=>{
  S.ping = Math.round(performance.now() - d.t);
  $uiPing.textContent = S.ping;
});

// Send inputs @ ~30Hz
setInterval(()=>{ socket.emit("input", S.input); }, 1000/30);

// Keyboard input
const keys = {};
addEventListener("keydown",(e)=>{ keys[e.key.toLowerCase()] = true; });
addEventListener("keyup",(e)=>{ keys[e.key.toLowerCase()] = false; });
function updateInput() {
  S.input.throttle = (keys["w"]||keys["arrowup"]) ? 1 : 0;
  S.input.brake    = (keys["s"]||keys["arrowdown"]) ? 1 : 0;
  S.input.steer    = (keys["a"]||keys["arrowleft"]) ? -1 : (keys["d"]||keys["arrowright"]) ? 1 : 0;
  S.input.refuel   = !!keys["f"];
}

// ---- World generation (must match server) ----
function noise1(seed, y){
  const y0 = Math.floor(y), y1 = y0+1, t = y - y0;
  const rnd = (n)=>{ const x = Math.sin((n + seed) * 12345.678) * 43758.5453; return x - Math.floor(x); };
  const smooth = t*t*(3-2*t);
  return rnd(y0)*(1-smooth) + rnd(y1)*smooth;
}
function roadCenterX(seed, yMeters){ return (noise1(seed, yMeters*0.0025) * 2 - 1) * 25; }
function poiForY(seed, yMeters){
  const SEG=800, k=Math.floor(yMeters/SEG), r=noise1(seed+9999, k*1.0);
  let type="none"; if(r<0.22) type="gas"; else if(r<0.38) type="hotel"; else if(r<0.54) type="store"; else if(r<0.68) type="town";
  const cx = roadCenterX(seed, k*SEG+SEG*0.5), side=(r<0.5?-1:1);
  return { k, type, x: cx + side*(7+10), y: k*SEG+SEG*0.5, radius: type==="town"?22:10 };
}

// ---- Render ----
const canvas = $("#game"), ctx = canvas.getContext("2d");
function resize(){ const r = canvas.getBoundingClientRect(); canvas.width = Math.floor(r.width); canvas.height = Math.floor(r.height); }
addEventListener("resize", resize); resize();
function lerp(a,b,t){ return a + (b-a)*t; }

function draw(){
  updateInput();

  const me = S.players.get(S.me);
  let camX=0, camY=0, myFuel=0, mySpeed=0, myDist=0;
  if (me) { camX = me.x; camY = me.y; myFuel = me.fuel; mySpeed = me.speed; myDist = me.distance; }

  ctx.clearRect(0,0,canvas.width,canvas.height);
  const g = ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,"#0a0e17"); g.addColorStop(1,"#09121f");
  ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

  const m2px = 8;
  const cx = canvas.width/2, cy = canvas.height*0.6;
  const roadHalf = 7;

  ctx.save();

  // Road band
  ctx.beginPath();
  for (let i=-60;i<=60;i++){
    const y = camY + i*4;
    const center = roadCenterX(S.seed, y);
    const sx = cx + (center - camX)*m2px;
    const sy = cy + (camY - y)*m2px;
    const left = sx - roadHalf*m2px;
    const right= sx + roadHalf*m2px;
    if (i===-60) ctx.moveTo(left, sy); else ctx.lineTo(left, sy);
  }
  for (let i=60;i>=-60;i--){
    const y = camY + i*4;
    const center = roadCenterX(S.seed, y);
    const sx = cx + (center - camX)*m2px;
    const sy = cy + (camY - y)*m2px;
    const right= sx + roadHalf*m2px;
    ctx.lineTo(right, sy);
  }
  ctx.closePath();
  ctx.shadowColor = "rgba(0,0,0,0.6)";
  ctx.shadowBlur = 10;
  ctx.fillStyle = "#2d3546";
  ctx.fill();

  // Lane markings
  ctx.shadowBlur = 0;
  ctx.lineWidth = 2;
  ctx.setLineDash([10,12]);
  ctx.strokeStyle = "rgba(250,250,200,0.8)";
  ctx.beginPath();
  for (let i=-60;i<=60;i++){
    const y = camY + i*10;
    const center = roadCenterX(S.seed, y);
    const sx = cx + (center - camX)*m2px;
    const sy = cy + (camY - y)*m2px;
    if (i===-60) ctx.moveTo(sx, sy); else ctx.lineTo(sx, sy);
  }
  ctx.stroke();
  ctx.setLineDash([]);

  // Road edges
  ctx.lineWidth = 3;
  ctx.strokeStyle = "rgba(255,255,255,0.35)";
  // left
  ctx.beginPath();
  for (let i=-60;i<=60;i++){
    const y = camY + i*6;
    const center = roadCenterX(S.seed, y);
    const sx = cx + (center - camX)*m2px;
    const sy = cy + (camY - y)*m2px;
    ctx.lineTo(sx - roadHalf*m2px, sy);
  }
  ctx.stroke();
  // right
  ctx.beginPath();
  for (let i=-60;i<=60;i++){
    const y = camY + i*6;
    const center = roadCenterX(S.seed, y);
    const sx = cx + (center - camX)*m2px;
    const sy = cy + (camY - y)*m2px;
    ctx.lineTo(sx + roadHalf*m2px, sy);
  }
  ctx.stroke();

  // POIs
  for (let dk=-4; dk<=6; dk++){
    const poi = poiForY(S.seed, camY + dk*800);
    if (poi.type === "none") continue;
    const sx = cx + (poi.x - camX)*m2px;
    const sy = cy + (camY - poi.y)*m2px;
    if (sy < -200 || sy > canvas.height+200) continue;

    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.beginPath(); ctx.ellipse(sx, sy+10, poi.radius*m2px*0.9, 8, 0, 0, Math.PI*2); ctx.fill();

    if (poi.type === "gas" || poi.type === "store") {
      ctx.fillStyle = poi.type === "gas" ? "#3ecf8e" : "#f6a93b";
      ctx.strokeStyle = "rgba(255,255,255,0.6)";
      roundedRect(ctx, sx - poi.radius*m2px*0.6, sy - 18, poi.radius*m2px*1.2, 26, 6, true, true);
      ctx.fillStyle = "rgba(0,0,0,0.65)";
      ctx.font = "14px ui-sans-serif"; ctx.textAlign="center";
      ctx.fillText(poi.type==="gas"?"‚õΩ":"üè™", sx, sy);
    } else if (poi.type === "hotel") {
      ctx.fillStyle = "#7dd3fc"; house(ctx, sx, sy, poi.radius*m2px*1.1);
    } else if (poi.type === "town") {
      ctx.fillStyle = "#a78bfa"; town(ctx, sx, sy, poi.radius*m2px*1.2);
    }
  }

  // Players
  for (const [id, pl] of S.players.entries()) {
    let x = pl.x, y = pl.y, angle = pl.angle, col = pl.color || "#fff", name = pl.name || "Driver";
    if (id !== S.me) {
      const it = S.interp.get(id);
      if (it) {
        const t = Math.min(1, (performance.now() - it.t0) / (it.t1 - it.t0));
        x = lerp(it.from.x, it.to.x, t);
        y = lerp(it.from.y, it.to.y, t);
        angle = lerp(it.from.angle, it.to.angle, t);
      }
    }
    const sx = cx + (x - camX)*m2px;
    const sy = cy + (camY - y)*m2px;

    ctx.fillStyle = "rgba(0,0,0,0.45)";
    ctx.beginPath(); ctx.ellipse(sx, sy+10, 18, 6, 0, 0, Math.PI*2); ctx.fill();

    ctx.save(); ctx.translate(sx, sy); ctx.rotate(-angle);
    carSprite(ctx, col);
    ctx.restore();

    ctx.font = "12px ui-sans-serif"; ctx.textAlign="center"; ctx.fillStyle="rgba(255,255,255,0.9)";
    ctx.fillText(name, sx, sy - 28);
  }

  ctx.restore();

  // HUD
  $uiSpeed.textContent = Math.max(0, (mySpeed|0));
  $uiDist.textContent = Math.max(0, (myDist|0));
  const pct = Math.max(0, Math.min(1, myFuel/100));
  $fuelFill.style.width = (pct*100) + "%";

  requestAnimationFrame(draw);
}
requestAnimationFrame(draw);

// Sprites / helpers
function roundedRect(ctx, x,y,w,h,r, fill=true, stroke=false){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  if (fill) ctx.fill(); if (stroke) ctx.stroke();
}
function carSprite(ctx, color){
  const grd = ctx.createLinearGradient(0,-20,0,20);
  grd.addColorStop(0, lighten(color, 20));
  grd.addColorStop(1, darken(color, 10));
  ctx.fillStyle = grd;
  roundedRect(ctx, -12, -22, 24, 44, 8, true, false);
  ctx.fillStyle = "rgba(200,230,255,0.9)";
  roundedRect(ctx, -9, -10, 18, 14, 4, true, false);
  ctx.fillStyle = "rgba(0,0,0,0.25)";
  roundedRect(ctx, -12, 16, 24, 4, 2, true, false);
  ctx.fillStyle = "#ffd166"; ctx.fillRect(-10,-22,6,3); ctx.fillRect(4,-22,6,3);
  ctx.fillStyle = "#ef476f"; ctx.fillRect(-10,19,6,3); ctx.fillRect(4,19,6,3);
}
function house(ctx, x,y,w){
  ctx.save(); ctx.translate(x,y);
  ctx.fillStyle = "#7dd3fc";
  roundedRect(ctx, -w*0.4, -16, w*0.8, 26, 6, true, false);
  ctx.fillStyle = "rgba(0,0,0,0.35)";
  ctx.beginPath(); ctx.moveTo(-w*0.45,-16); ctx.lineTo(0,-28); ctx.lineTo(w*0.45,-16); ctx.closePath(); ctx.fill();
  ctx.restore();
}
function town(ctx, x,y,w){
  ctx.save(); ctx.translate(x,y);
  for (let i=0;i<4;i++){
    ctx.fillStyle = i%2? "#9dd6b9" : "#f6a93b";
    roundedRect(ctx, -w*0.6 + i*(w*0.35), -18 - i*2, w*0.28, 26+i*3, 4, true, false);
  }
  ctx.restore();
}
function lighten(hex, amt){ const c = parseInt(hex.slice(1),16); let r=(c>>16)+amt,g=((c>>8)&255)+amt,b=(c&255)+amt; r=Math.min(255,Math.max(0,r)); g=Math.min(255,Math.max(0,g)); b=Math.min(255,Math.max(0,b)); return "#"+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1); }
function darken(hex, amt){ return lighten(hex, -amt); }

function updateLobbyList(players){
  const $list = $("#lobbyList"); $list.innerHTML = "";
  players.forEach(p=>{
    const el = document.createElement("div");
    el.className = "tag";
    el.style.borderColor = "rgba(255,255,255,0.18)";
    el.innerHTML = `<span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:${p.color};margin-right:8px"></span>
                    <b>${escapeHtml(p.name)}</b>
                    ${p.isHost ? " (Host)" : ""} ‚Äî ${p.ready?"‚úÖ Ready":"‚è≥ Not ready"}`;
    $list.appendChild(el);
  });
}
function escapeHtml(s){ return (s||"").replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c])); }

show("home");
addEventListener("orientationchange", ()=>setTimeout(()=>{ const r = canvas.getBoundingClientRect(); canvas.width = Math.floor(r.width); canvas.height = Math.floor(r.height); }, 150));

</script>
</body>
</html>
